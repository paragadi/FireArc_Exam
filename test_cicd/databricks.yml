bundle:
  name: test_cicd

include:
  - resources/*.yml
  - resources/*/*.yml

variables:
  env_file:
    description: "Repo path to env YAML (src/env/dev.yml etc.)"
  env:
    description: "dev | test | prod"
  uc_catalog:
    description: "UC catalog name"
  uc_schema:
    description: "UC schema name"
  table_name:
    description: "Target table name"
  job_name_suffix:
    description: "Suffix for job names (used to avoid collisions in dev)"

targets:
  dev:
    mode: development
    default: true
    workspace:
      host: https://dbc-9023e4df-1d3e.cloud.databricks.com
      root_path: /Workspace/Shared/test_cicd/dev/${workspace.current_user.userName}
    variables:
      env: dev
      env_file: src/env/dev.yml
      uc_catalog: my_catalog_dev
      uc_schema: dim
      table_name: dim_date
      job_name_suffix: _${workspace.current_user.userName}

  test:
    mode: production
    workspace:
      host: https://dbc-9023e4df-1d3e.cloud.databricks.com
      root_path: /Workspace/Shared/test_cicd/test
    variables:
      env: test
      env_file: src/env/test.yml
      uc_catalog: my_catalog_test
      uc_schema: dim
      table_name: dim_date
      job_name_suffix: ""

  prod:
    mode: production
    workspace:
      host: https://dbc-9023e4df-1d3e.cloud.databricks.com
      root_path: /Workspace/Shared/test_cicd/prod
    run_as:
      user_name: paragadi@gmail.com
    variables:
      env: prod
      env_file: src/env/prod.yml
      uc_catalog: my_catalog_prod
      uc_schema: dim
      table_name: dim_date
      job_name_suffix: ""
